<div class="container cart-container my-4">
  <h3 class="text-center mb-4">Your Cart</h3>

  <div class="row g-3">
    @for (product of productsArray; track product.id) {
      <div class="col-md-3 product">
        <div class="card p-2 text-center">
          <img 
            [src]="product.image" 
            [alt]="product.title" 
            class="img-fluid product-img" 
            loading="lazy" 
            decoding="async"
          />
          <h4 class="fs-6 mt-2">{{ product.title }}</h4>
          <p class="fw-bold">{{ product.price | currency:'EGP' }}</p>

          <div class="quantity d-flex justify-content-center align-items-center my-2">
            <button class="btn-qty" (click)="decreaseQuantity(product)">-</button>
            <span class="mx-2">{{ product.quantity || 1 }}</span>
            <button class="btn-qty" (click)="increaseQuantity(product)">+</button>
          </div>

          <button class="main-btn" (click)="removeProduct(product)">Remove</button>
        </div>
      </div>
    }
  </div>

  <div class="mt-4 text-center">
    <h4>Total: {{ total | currency:'EGP' }}</h4>
  </div>

  <div class="mt-3 text-center">
    <h5>Select Payment Method</h5>
    <button class="main-btn mx-2" (click)="selectPayment('Vodafone Cash')">Vodafone Cash</button>
    <button class="main-btn mx-2" (click)="selectPayment('Orange Cash')">Orange Cash</button>
    <button class="main-btn mx-2" (click)="selectPayment('Visa')">Visa</button>
  </div>

  @if (paymentMethod) {
    <div class="mt-3 text-center">
      <h5>Enter Payment Details ({{ paymentMethod }})</h5>

      @if (paymentMethod === 'Vodafone Cash' || paymentMethod === 'Orange Cash') {
        <div>
          <input type="text" [(ngModel)]="paymentData.account" placeholder="Enter Number" class="form-control my-2">
          <textarea [(ngModel)]="paymentData.instructions" placeholder="Enter Instructions" class="form-control my-2"></textarea>
        </div>
      }

      @if (paymentMethod === 'Visa') {
        <div>
          <input type="text" [(ngModel)]="paymentData.cardNumber" placeholder="Card Number" class="form-control my-2">
          <input type="month" [(ngModel)]="paymentData.expiryDate" class="form-control my-2">
          <input type="text" [(ngModel)]="paymentData.cvv" placeholder="CVV" class="form-control my-2">
          <input type="text" [(ngModel)]="paymentData.cardHolder" placeholder="Card Holder Name" class="form-control my-2">
        </div>
      }

      <button class="main-btn mt-3" (click)="confirmPayment()">Confirm Payment</button>
    </div>
  }
</div>
